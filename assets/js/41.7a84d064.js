(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{391:function(t,s,a){"use strict";a.r(s);var e=a(42),p=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"iptables防火墙"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iptables防火墙"}},[t._v("#")]),t._v(" iptables防火墙")]),t._v(" "),a("h2",{attrs:{id:"iptables最常用的规则示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iptables最常用的规则示例"}},[t._v("#")]),t._v(" iptables最常用的规则示例")]),t._v(" "),a("p",[t._v("https://www.cnblogs.com/EasonJim/p/8339162.html")]),t._v(" "),a("h3",{attrs:{id:"_1、删除已有规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、删除已有规则"}},[t._v("#")]),t._v(" 1、删除已有规则")]),t._v(" "),a("p",[t._v("iptables -F\niptables –flush")]),t._v(" "),a("h3",{attrs:{id:"_2、设置链的默认策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、设置链的默认策略"}},[t._v("#")]),t._v(" 2、设置链的默认策略")]),t._v(" "),a("p",[t._v("iptables -P INPUT DROP\niptables -P FORWARD DROP")]),t._v(" "),a("h5",{attrs:{id:"iptables-p-output-drop-一般不对出站的数据包做限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iptables-p-output-drop-一般不对出站的数据包做限制"}},[t._v("#")]),t._v(" iptables -P OUTPUT DROP ## 一般不对出站的数据包做限制")]),t._v(" "),a("h3",{attrs:{id:"_3、丢弃来自ip地址x-x-x-x的包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、丢弃来自ip地址x-x-x-x的包"}},[t._v("#")]),t._v(" 3、丢弃来自IP地址x.x.x.x的包")]),t._v(" "),a("p",[t._v("iptables -A INPUT -s x.x.x.x -j DROP")]),t._v(" "),a("h4",{attrs:{id:"_3-1、阻止来自ip地址x-x-x-x-eth0-tcp的包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1、阻止来自ip地址x-x-x-x-eth0-tcp的包"}},[t._v("#")]),t._v(" 3.1、阻止来自IP地址x.x.x.x eth0 tcp的包")]),t._v(" "),a("p",[t._v("iptables -A INPUT -i eth0 -s x.x.x.x -j DROP\niptables -A INPUT -i eth0 -p tcp -s x.x.x.x -j DROP")]),t._v(" "),a("h3",{attrs:{id:"_4、允许所有来自外部的ssh连接请求，即只允许进入eth0接口，并且目标端口为22的数据包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、允许所有来自外部的ssh连接请求，即只允许进入eth0接口，并且目标端口为22的数据包"}},[t._v("#")]),t._v(" 4、允许所有来自外部的SSH连接请求，即只允许进入eth0接口，并且目标端口为22的数据包")]),t._v(" "),a("p",[t._v("iptables -A INPUT -i eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\niptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT")]),t._v(" "),a("h3",{attrs:{id:"_5、仅允许来自于192-168-100-0-24域的用户的ssh连接请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、仅允许来自于192-168-100-0-24域的用户的ssh连接请求"}},[t._v("#")]),t._v(" 5、仅允许来自于192.168.100.0/24域的用户的ssh连接请求")]),t._v(" "),a("p",[t._v("iptables -A INPUT -i eth0 -p tcp -s 192.168.100.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\niptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT")]),t._v(" "),a("h3",{attrs:{id:"_6、允许所有来自web-http的连接请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、允许所有来自web-http的连接请求"}},[t._v("#")]),t._v(" 6、允许所有来自web - http的连接请求")]),t._v(" "),a("p",[t._v("iptables -A INPUT -i eth0 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT\niptables -A OUTPUT -o eth0 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT")]),t._v(" "),a("p",[t._v("iptables -A INPUT -i eth0 -p tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT\niptables -A OUTPUT -o eth0 -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT")]),t._v(" "),a("h3",{attrs:{id:"_7、使用multiport-将多个规则结合在一起（允许所有ssh-http-https的流量访问）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、使用multiport-将多个规则结合在一起（允许所有ssh-http-https的流量访问）"}},[t._v("#")]),t._v(" 7、使用multiport 将多个规则结合在一起（允许所有ssh,http,https的流量访问）")]),t._v(" "),a("p",[t._v("iptables -A INPUT -i eth0 -p tcp -m multiport --dports 22,80,443 -m state --state NEW,ESTABLISHED -j ACCEPT\niptables -A OUTPUT -o eth0 -p tcp -m multiport --sports 22,80,443 -m state --state ESTABLISHED -j ACCEPT")]),t._v(" "),a("h3",{attrs:{id:"_8、负载平衡传入的网络流量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8、负载平衡传入的网络流量"}},[t._v("#")]),t._v(" 8、负载平衡传入的网络流量")]),t._v(" "),a("p",[t._v("iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 0 -j DNAT --to-destination 192.168.1.101:443\niptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 1 -j DNAT --to-destination 192.168.1.102:443\niptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 2 -j DNAT --to-destination 192.168.1.103:443")]),t._v(" "),a("h3",{attrs:{id:"_9、允许外部主机ping内部主机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9、允许外部主机ping内部主机"}},[t._v("#")]),t._v(" 9、允许外部主机ping内部主机")]),t._v(" "),a("p",[t._v("iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT\niptables -A OUTPUT -p icmp --icmp-type echo-reply -j ACCEPT")]),t._v(" "),a("h3",{attrs:{id:"_10、允许来自网络192-168-101-0-24的rsync连接请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10、允许来自网络192-168-101-0-24的rsync连接请求"}},[t._v("#")]),t._v(" 10、允许来自网络192.168.101.0/24的rsync连接请求")]),t._v(" "),a("p",[t._v("iptables -A INPUT -i eth0 -p tcp -s 192.168.101.0/24 --dport 873 -m state --state NEW,ESTABLISHED -j ACCEPT\niptables -A OUTPUT -o eth0 -p tcp --sport 873 -m state --state ESTABLISHED -j ACCEPT")]),t._v(" "),a("h3",{attrs:{id:"_11、mysql数据库与web服务跑在同一台服务器上。有时候我们仅希望dba和开发人员从内部网络（192-168-100-0-24）直接登录数据库，可尝试以下命令："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11、mysql数据库与web服务跑在同一台服务器上。有时候我们仅希望dba和开发人员从内部网络（192-168-100-0-24）直接登录数据库，可尝试以下命令："}},[t._v("#")]),t._v(" 11、MySQL数据库与web服务跑在同一台服务器上。有时候我们仅希望DBA和开发人员从内部网络（192.168.100.0/24）直接登录数据库，可尝试以下命令：")]),t._v(" "),a("p",[t._v("iptables -A INPUT -i eth0 -p tcp -s 192.168.100.0/24 --dport 3306 -m state --state NEW,ESTABLISHED -j ACCEPT\niptables -A OUTPUT -o eth0 -p tcp --sport 3306 -m state --state ESTABLISHED -j ACCEPT")]),t._v(" "),a("h3",{attrs:{id:"_12、将来自422端口的流量全部转到22端口。-这意味着我们既能通过422端口又能通过22端口进行ssh连接。启用dnat转发。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12、将来自422端口的流量全部转到22端口。-这意味着我们既能通过422端口又能通过22端口进行ssh连接。启用dnat转发。"}},[t._v("#")]),t._v(" 12、将来自422端口的流量全部转到22端口。  这意味着我们既能通过422端口又能通过22端口进行ssh连接。启用DNAT转发。")]),t._v(" "),a("h5",{attrs:{id:"系统开启转发功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统开启转发功能"}},[t._v("#")]),t._v(" 系统开启转发功能")]),t._v(" "),a("p",[t._v("echo 1 > /proc/sys/net/ipv4/ip_forward\niptables -t nat -A PREROUTING -p tcp -d 192.168.102.37 --dport 422 -j DNAT --to 192.168.102.37:22")]),t._v(" "),a("p",[t._v("#####除此之外，还需要允许连接到422端口的请求\niptables -A INPUT -i eth0 -p tcp --dport 422 -m state --state NEW,ESTABLISHED -j ACCEPT\niptables -A OUTPUT -o eth0 -p tcp --sport 422 -m state --state ESTABLISHED -j ACCEPT")]),t._v(" "),a("h2",{attrs:{id:"iptables-四表五链"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iptables-四表五链"}},[t._v("#")]),t._v(" iptables 四表五链")]),t._v(" "),a("p",[t._v("https://www.cnblogs.com/zhujingzhi/p/9706664.html")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/bash")]),t._v("\n/sbin/iptables -F\n/sbin/iptables -X\n/sbin/iptables -F -t nat\n/sbin/iptables -X -t nat\n/sbin/iptables -P INPUT ACCEPT\n/sbin/iptables -P OUTPUT ACCEPT\n/sbin/iptables -A INPUT -i lo -j ACCEPT\n/sbin/iptables -A INPUT -s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.0/24 -j ACCEPT\n/sbin/iptables -A INPUT -s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.0/24  -m state --state NEW -m tcp -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10050")]),t._v(" -j ACCEPT\n/sbin/iptables -A INPUT -s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.0/16 -j ACCEPT\n/sbin/iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\n/sbin/iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" -j ACCEPT\n/sbin/iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" -j ACCEPT\n \n/sbin/iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10240")]),t._v(" -j ACCEPT\n/sbin/iptables -t nat -A PREROUTING -i em1 -d "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123.59")]),t._v(".32.113 -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10240")]),t._v(" -j DNAT --to-destination "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.186:5011\n \n/sbin/iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("808")]),t._v(" -j ACCEPT\n \n/sbin/iptables -A INPUT -s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123.120")]),t._v(".0.0/16 -m state --state NEW -m tcp -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" -j ACCEPT\n/sbin/iptables -A INPUT -s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123.120")]),t._v(".0.0/16 -m state --state NEW -m tcp -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" -j ACCEPT\n/sbin/iptables -A INPUT -s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("114.248")]),t._v(".0.0/16 -m state --state NEW -m tcp -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" -j ACCEPT\n/sbin/iptables -A INPUT -s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("221.222")]),t._v(".0.0/16 -m state --state NEW -m tcp -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" -j ACCEPT\n/sbin/iptables -A INPUT -s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.0/24 -m state --state NEW -m tcp -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" -j ACCEPT\n \n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("IPLIST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"117.122.219.0/24 61.164.149.0/24 122.228.208.0/24 221.222.0.0/16 114.248.0.0/16 123.120.0.0/16 111.201.0.0/16"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[t._v("ip")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${IPLIST}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n        /sbin/iptables -A INPUT -s "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ip}")]),t._v(" -p tcp -m state --state NEW -m tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v(":5100 -j ACCEPT\n        /sbin/iptables -A INPUT -s "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ip}")]),t._v(" -p tcp -m state --state NEW -m tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5600")]),t._v(":5700 -j ACCEPT\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("nginx")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("docker inspect --format "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{{ .NetworkSettings.IPAddress }}'")]),t._v(" synginx"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n/sbin/iptables  -t nat -A PREROUTING -d "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123.59")]),t._v(".32.113 -p tcp -m tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" -j DNAT --to-destination "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${nginx}")]),t._v(":80\n/sbin/iptables -t nat -A POSTROUTING -s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.0/16 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" -o docker0 -j MASQUERADE\n/sbin/iptables -A INPUT -p ICMP  -j ACCEPT\n/sbin/iptables -A INPUT -j DROP\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br")])])])}),[],!1,null,null,null);s.default=p.exports}}]);