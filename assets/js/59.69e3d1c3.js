(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{409:function(s,n,a){"use strict";a.r(n);var t=a(42),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"consul"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#consul"}},[s._v("#")]),s._v(" Consul")]),s._v(" "),a("h3",{attrs:{id:"consul集群部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#consul集群部署"}},[s._v("#")]),s._v(" consul集群部署")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 下文是搭建一套3节点的集群，搭建过程如下： ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 1.准备节服务器： ")]),s._v("\n- consul1：10.100.110.71 \n- consul2：10.100.110.72 \n- consul3：10.100.110.73 \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 2.下载consul二进制包")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 3.启动consul ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.100")]),s._v(".110.72执行：\n\nconsul agent -server -bootstrap-expect "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" -bind"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.100")]),s._v(".110.71 -client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 -data-dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/consul -node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("consul1 -ui "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\n- server： 以server身份启动。 \n- bootstrap-expect：集群要求的最少server数量，当低于这个数量，集群即失效。 \n- data-dir：data存放的目录，更多信息请参阅consul数据同步机制 \n- node：节点id，在同一集群不能重复。 \n- bind：监听的ip地址。 \n- client 客户端的ip地址 \n- ui:启动web客户端\n- "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" ：在后台运行，此为linux脚本语法 \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 更多参数及配置说明见consul官方说明文档 https://www.consul.io/docs/agent/options.html。 ")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 其他两台机器（10.100.110.72、10.100.110.73）分别执行：")]),s._v("\nconsul agent -server -bootstrap-expect "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" -bind"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.100")]),s._v(".110.72 -client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 -data-dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/consul -node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("consul2 -ui\n\nconsul agent -server -bootstrap-expect "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" -bind"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.100")]),s._v(".110.73 -client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 -data-dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/consul -node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("consul3 -ui\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 分别在consul2、consul3 执行加入集群：")]),s._v("\nconsul "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.100")]),s._v(".110.71\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 整个consul server 集群就算完成了，可以利用consul members查看集群中包含的node信息。使用consul info命令可以查看当前节点状态，包括是否在集群中，是否为leader（主）。")]),s._v("\nconsul members\n\nNode     Address            Status  Type    Build  Protocol  DC   Segment\nconsul1  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.100")]),s._v(".110.71:8301  alive   server  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(".2  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         dc1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("all"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nconsul2  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.100")]),s._v(".110.72:8301  alive   server  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(".2  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         dc1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("all"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nconsul3  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.100")]),s._v(".110.73:8301  alive   server  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(".2  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         dc1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("all"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 可视化的服务web界面：http://10.100.110.71:8500/ui ")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);