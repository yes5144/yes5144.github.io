(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{421:function(s,a,t){"use strict";t.r(a);var n=t(42),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"install"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#install"}},[s._v("#")]),s._v(" install")]),s._v(" "),t("blockquote",[t("p",[s._v("saltstack采用c/s架构，角色分为master/slave，建议采用yum部署")])]),s._v(" "),t("h3",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 指定阿里云epel.repo, salt.repo 华为云 Centos-Base.repo")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" https://mirrors.aliyun.com/saltstack/yum/redhat/salt-repo-latest-2.el6.noarch.rpm\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s/repo.saltstack.com/mirrors.aliyun.com\\/saltstack/g"')]),s._v(" /etc/yum.repos.d/salt-latest.repo\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s/latest/2016.11/g"')]),s._v(" /etc/yum.repos.d/salt-latest.repo\n\nyum makecache\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" salt-master salt-minion salt-api\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"salt-api安装配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#salt-api安装配置"}},[s._v("#")]),s._v(" salt-api安装配置")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("https://www.cnblogs.com/gavin11/p/11599859.html\n## salt-api 安装\nhttps://www.cnblogs.com/xiewenming/p/7716660.html\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"配置minion"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置minion"}},[s._v("#")]),s._v(" 配置minion")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("  /etc/salt/minion\nmaster: master-id\nid: hostname"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("weiyi"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"管理-salt-key"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#管理-salt-key"}},[s._v("#")]),s._v(" 管理 salt key")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("salt-key  -L\nsalt-key  -A\nsalt-key  -D\nsalt-key  -a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ID"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nsalt-key  -d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ID"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nsalt-key  -l acc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -c -v "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Accepted Keys:'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"salt命令入门"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#salt命令入门"}},[s._v("#")]),s._v(" salt命令入门")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("\nhttps://docs.saltstack.com/en/latest/ref/runners/all/salt.runners.jobs.html\nhttp://dearweb.xin/2017/10/24/salt-file-backup/\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#################################")]),s._v("\nsalt -d  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看帮助文档")]),s._v("\nsalt -d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看service相关模块命令")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" sys.doc  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看帮助文档")]),s._v("\nsalt-key  -L            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查询所有接收到的证书")]),s._v("\nsalt-key  -a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("证书名"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#接收单个证书")]),s._v("\nsalt-key  -A            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#接受所有证书")]),s._v("\nsalt-key  -d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("证书名"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除单个证书")]),s._v("\nsalt-key  -D            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除所有证书")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## service")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" service.get_all  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##获取主机所有服务")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" service.reload sshd  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##重载sshd服务")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node1.com'")]),s._v(" service.status mysql  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看mysql服务状态")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node1.com'")]),s._v(" service.start mysql  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##启动mysql服务")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node1.com'")]),s._v(" cmd.run "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'service mysql status'")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##与上面一样查看服务")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" sys.list_modules  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##模块列表")]),s._v("\nsalt-cp "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v("  /etc/hosts   /etc/hosts  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##把master上的hosts文件分发到所有主机")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" cp.get_file salt://ceshi/b /tmp/test  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##把salt-master端相应的文件，分发文件到minion端")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" cp.get_dir salt://zabbix /tmp  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##把salt-master端相应的目录，分发文件到minion端")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" file.copy /tmp/zabbix.sls /tmp/sls  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##把salt-master端对应文件拷贝到minion端相应目录下")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## pkg")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" pkg.list_pkgs   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##显示软件包版本列表")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" pkg.version python  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##显示软件包版本信息")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" pkg.install httpd  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##安装软件包")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cmd.script:'")]),s._v("\n        salt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" cmd.script salt://scripts/runme.sh\n        salt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" cmd.script salt://scripts/runme.sh "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'arg1 arg2 \"arg 3\"'")]),s._v("\n        salt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" cmd.script salt://scripts/windows_task.ps1 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("args")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' -Input c:"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[s._v("\\t")]),s._v("mp\\infile.txt'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'powershell'")]),s._v("\n        salt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" cmd.script salt://scripts/runme.sh "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("stdin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'one"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("two"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("three"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("four"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("five"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cmd.shell:'")]),s._v("\n        This passes the cmd argument directly to the shell\n        salt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" cmd.shell "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"ls -l | awk '/foo/{print \\"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'\"")]),s._v("\n        salt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" cmd.shell "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("template")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("jinja "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ls -l /tmp/'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("grains"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("."),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" | awk '/foo/{print \\"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'\"")]),s._v("\n        salt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" cmd.shell "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Get-ChildItem C:\\ "')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'powershell'")]),s._v("\n        salt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" cmd.shell "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"grep f"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("stdin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'one"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("two"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("three"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("four"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("five"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("'")]),s._v("\n        salt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" cmd.shell "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cmd")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sed -e s/=/:/g'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cmd.shells:'")]),s._v("\n        salt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" cmd.shells\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cmd.tty:'")]),s._v("\n        salt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" cmd.tty tty0 "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'This is a test'")]),s._v("\n        salt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" cmd.tty pts3 "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'This is a test'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cmd.which:'")]),s._v("\n        salt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" cmd.which "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## grains")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" grains.ls   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看grains分类")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" grains.items   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看grains所有信息")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" grains.item osrelease  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看grains某个信息")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## manage")]),s._v("\nsalt-run manage.up   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看存活的minion")]),s._v("\nsalt-run manage.down  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看死掉的minion")]),s._v("\nsalt-run manage.down "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("removekeys")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("True   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看down掉的minion，并将其删除")]),s._v("\nsalt-run manage.status   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看minion的相关状态")]),s._v("\nsalt-run manage.versions   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看slat的所有master和minion的版本信息")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## jobs")]),s._v("\nsalt-run jobs.active\nsalt "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("* saltutil.running  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看运行的jobs ID")]),s._v("\nsalt "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("* saltutil.kill_job "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20151209034239907625")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##kill掉进程ID")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### saltutil模块中的job管理方法")]),s._v("\nsaltutil.running "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看minion当前正在运行的jobs")]),s._v("\nsaltutil.find_job"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看指定jid的job(minion正在运行的jobs)")]),s._v("\nsaltutil.signal_job"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("single"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#给指定的jid进程发送信号")]),s._v("\nsaltutil.term_job "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#终止指定的jid进程(信号为15)")]),s._v("\nsaltutil.kill_job "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#终止指定的jid进程(信号为9)")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### salt runner中的job管理方法")]),s._v("\nsalt-run jobs.active "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看所有minion当前正在运行的jobs(在所有minions上运?saltutil.running)")]),s._v("\nsalt-run jobs.lookup_jid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从master jobs cache中查询指定jid的运行结果")]),s._v("\nsalt-run jobs.list_jobs "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#列出当前master jobs cache中的所有job")]),s._v("\n\nsalt-run jobs.active\nsalt-run jobs.list_jobs\nsalt-run jobs.list_job "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20151208172130003474")]),s._v("\nsalt-run jobs.lookup_jid "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20190426130418644064")]),s._v("\n\nhttps://docs.saltstack.com/en/latest/ref/states/backup_mode.html"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#file-state-backups")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br")])]),t("h4",{attrs:{id:"组织主机节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#组织主机节点"}},[s._v("#")]),s._v(" 组织主机节点")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("  /etc/salt/master\nnodegroups:\n  web: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'L@192.168.204.12,192.168.204.13'")]),s._v("\n  db: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'L@192.168.204.32,192.168.204.33'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 无需重启salt-master，保存即可生效")]),s._v("\nsalt -N web test.ping\nsalt -N db test.ping\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h4",{attrs:{id:"模块的调用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#模块的调用"}},[s._v("#")]),s._v(" 模块的调用")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("## ping模块\nsalt node1 test.ping\n## cmd模块\nsalt node2 cmd.run 'id'\nsalt node2 cmd.run 'curl -L http://scripts.example.com/scripts/example.sh |bash'\n### 想携带参数？\nsalt node2 cmd.scripts salt://scripts/example.sh \"arg1 arg2 'arg   3'\"\nsalt node2 cmd.scripts http://scripts.example.com/scripts/example.sh \"arguments\"\n\n## pkg模块\nsalt node2 pkg.install 'vsftpd,lftp'\nsalt node2 pkg.remove 'vsftpd,lftp'\n\n## file.replace\nsalt node1 file.replace /ets/ssh/sshd_config pattern='#Port 22' repl='Port 22'\n\n## manage\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("h4",{attrs:{id:"sls-salt-state"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sls-salt-state"}},[s._v("#")]),s._v(" SLS(salt state)")]),s._v(" "),t("h4",{attrs:{id:"grain"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#grain"}},[s._v("#")]),s._v(" Grain")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("salt node1 grains.ls "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l\nsalt node1 grains.item server_type\nsalt node1 grains.item ip4_interfaces:eth0\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"pillar"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pillar"}},[s._v("#")]),s._v(" Pillar")]),s._v(" "),t("blockquote",[t("p",[s._v("Pillar和Grain的区别是什么？\nGrain是在Master上面创建的，但它的取值来自于Minion，而且Grain的代码是通过调用模块saltutil.sync_grains将其同步到Minion上面执行的。在执行结果没有返回之前，Grain的值时未知的，需要根据Minion的实际环境确认。\n和Grain不同的是，Pillar是在Master上定义和存储的，是为了编写sls文件时便于引用而创建的，它的变量和赋值在执行之前就已经确定好了，和Minion的状态没有关系。")])]),s._v(" "),t("h3",{attrs:{id:"salt-run-结果详情查看"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#salt-run-结果详情查看"}},[s._v("#")]),s._v(" salt-run 结果详情查看")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("salt-run jobs.list_jobs   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -B20  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.1.3'")]),s._v("\nsalt-run jobs.list_jobs   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -B20  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Python-2.7.3/bin/supervisorctl stop dj_gm_ser'")]),s._v("\nsalt-run jobs.lookup_jid  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20191107102202302460")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"salt-api参数变更"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#salt-api参数变更"}},[s._v("#")]),s._v(" salt-api参数变更")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("https://docs.saltstack.com/en/latest/ref/clients/index.html\n\ntgt_type --\n\n    The type of tgt. Allowed values:\n    glob - Bash glob completion - Default\n    pcre - Perl style regular expression\n    list - Python list of hosts\n    grain - Match based on a grain comparison\n    grain_pcre - Grain comparison with a regex\n    pillar - Pillar data comparison\n    pillar_pcre - Pillar data comparison with a regex\n    nodegroup - Match on nodegroup\n    range - Use a Range server for matching\n    compound - Pass a compound match string\n    ipcidr - Match based on Subnet (CIDR notation) or IPv4 address.\nChanged in version 2017.7.0: Renamed from expr_form to tgt_type\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);